---
title: cuda优化大概思路
date: 2020-09-23 00:03:39
categories: 编程优化
tags: 
- cuda编程
- 优化思路
---
---

 - cuda程序的性能优化主要围绕三个基本的策略展开：
    1：最大化程序的并行执行
    2：优化内存的使用，实现最大的带宽
    3：优化指令使用，实现最大的指令吞吐量


----------

 

 - 具体的操作：
&ensp;&ensp;关于并行化：在程序中确定可以优化的模块之后，根据源代码的特点，将其并行化，例如调用现成的gpu优化库，或者像并行编译器提供一些预处理指令等。也可能需要对源代码进行重构以实现相应的并行化。
&ensp;&ensp;关于内存的优化：尽量减少主机和gpu设备间的数据传输，在程序运行过程中产生的中间变量尽量存储在设备内存中，由设备进行操作，并在没有映射或者复制到主机内存的情况下销毁。在必要的数据传输中，尽量将小批次的数据打包成更大的批次进行传输，即便是这样会需要将不连续的内存区域打包到一个相邻的缓冲区，并且在传输完成之后解包，但是他的开销仍然比使用小批次多次传输的开销小得多。然后在运行过程中尽可能地合并全局内存访问，善于利用共享内存尽量减少全局内存的冗余访问。有时候最好的优化甚至是在需要时重新进行简单的计算去得到需要的数据来避免任何数据的传输。
&ensp;&ensp;关于指令优化：可以使用移位操作避免除法操作和模计算，使用有符号整数而不是无符号数作为循环计数器，尽量避免双进度到浮点数的自动转换，尽量选择更专业的数学函数来代替通用的数学函数（可能会损失一点精度，大部分情况下的损失都是可以接受的）。尽量减少全局内存的使用，尽可能使用共享内存访问。尽量少使用吞吐量低的指令，由于gpu的SIMT(单指令多线程)特点。必须特别注意控制流指令的使用。避免在同一个wrap内使用不同的执行路径，例如if,switch,do,for,while等会导致同一个wrap内线程产生不同的分支。降低指令吞吐量。
